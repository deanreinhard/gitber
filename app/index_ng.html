<!doctype html>
<html ng-app>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html">
    <title>Github API Webapp using AngularJS - Not So Clever Demo</title>
    <link rel="stylesheet" type="text/css" media="all" href="css/styles.css">
</head>

<body ng-controller="GitHubCtrl">

<div id="w">
    <div>
        <h1>Simple Github API Webapp</h1>
        <p>Enter a single Github username below and click the button to display profile info.</p>
        <input type="text" id="ghusername" ng-model="username" placeholder="Github username..."><br />
        <a href="#" id="ghsubmitbtn" ng-click="getGitInfo()">Pull Single User Data</a><br />
        <a href="#" id="ghsubmitbtn" ng-click="getGitOrgInfo()">Pull Organization Data</a>

        <div id="ghapidata" class="clearfix"></div>
    </div>

    <!-- Repo info    -->
    <div ng-show="userNotFound">
        <h2>No User Info Found</h2>
    </div>
    <div ng-show="loaded">

        <h2> {{user.name}}
            <span class="smallname">(@<a href="{{user.html_url}}" target="_blank"> {{user.login}} </a>)</span>
        </h2>

        <div class="ghcontent">
            <div class="avi">
                <a href="{{ user.html_url }}" target="_blank">
                    <img src="{{ user.avatar_url }}" width="80" height="80" alt="{{ user.login }}"></a>
            </div>
            User Name : {{user.login}} <br>
            Followers: {{ user.followers }} - Following: {{ user.following }}<br>
            Repos: {{ user.public_repos }}<br>
            Join date: {{ user.created_at | date:'yyyy-MM-dd HH:mm:ss Z'}}<br>
            Email : {{user.email}}<br>
            Blog : {{user.blog}}<br>
            Location : {{user.location}}<br>
        </div>
    </div>

    <!-- Members list    -->
    <div class="span8">
        <div class="row-fluid">
            <div id="results2" class="white">
                <div ng-show="memberNotFound">
                    <h2>No Member Found</h2>
                </div>
                <div ng-show="membersFound">
                    <p><strong>Members List:</strong></p>
                    <ul ng-repeat="member in members">
                        <li class="atleta">
                            <a href="#" name="{{member.login}}" ng-click="getGitMemInfo(member.login, $event)" >{{member.login}}</a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <!-- Repos list    -->
    <div class="span8">
        <div class="row-fluid">
            <div id="results" class="white">
                <div ng-show="reposFound">
                    <p><strong>Repos List:</strong></p>
                    <ul ng-repeat="repo in repos">
                        <li>
                            <div class="row-fluid">
                                <div class="repo">
                                    <div class="span12 repoDetails">
                                        <blockquote>
                                            <h3 class="blue" style="margin-bottom:0px;"><a href="{{repo.html_url}}" target="_blank"> {{repo.name}} </a></h3>
                                            <p><strong>Language:</strong> {{repo.language}}</p>
                                            <p><strong>File Size:</strong> {{repo.size}}kb</p>
                                            <p><strong>Description:</strong></p>
                                            <div class="row-fluid">
                                                <div class="span10">
                                                    <pre>{{repo.readmeFile}}</pre>
                                                </div>
                                            </div>
                                            <small>Created on {{repo.created_at | date:'yyyy-MM-dd HH:mm:ss Z'}}</small>
                                        </blockquote>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    Credit to : <a href="http://code.notsoclever.cc/simple-github-api-webapp-angularjs-style/">http://code.notsoclever.cc/simple-github-api-webapp-angularjs-style/</a>
</div>


<script>
    function GitHubCtrl($scope, $http) {
        $scope.client='69af424226e15a6396dd';
        $scope.secret='683d05837403207f247939ab21668065352b65db';
        $scope.oauth = '?client_id=' + $scope.client+'&client_secret=' + $scope.secret;
        var url;
        /*
        Getting the Single Git repo
         */
        $scope.getGitInfo = function () {
            $scope.repos = null;
            $scope.reposFound = false;
            $scope.members = null;
            $scope.membersFound = false;
            $scope.memberNotFound = false;
            getrepos($scope.username);
        };

        /*
         Getting the Member info by Organization
         */
        $scope.getGitMemInfo = function(username, event) {
            getrepos(username);
        };

        /*
         Getting the Oranization Git repo
         */
        $scope.getGitOrgInfo = function () {
            $scope.repos = null;
            $scope.reposFound = false;
            getrepos($scope.username);

            $scope.memberNotFound = false;

            url = 'https://api.github.com/orgs/' + $scope.username + '/members' + $scope.oauth;

            $http.get(url).success(function (data) {
                $scope.members = data;
                $scope.membersFound = data.length > 0;
            })
                .error(function () {
                    $scope.memberNotFound = true;
                });
        };

        function getrepos(username){
            $scope.userNotFound = false;
            $scope.loaded = false;
            if(typeof username != 'undefined') {

                url = "https://api.github.com/users/" + username + $scope.oauth;
                $http.get(url).success(function (data) {
                    if (data.name == "") data.name = data.login;
                    $scope.user = data;
                    $scope.loaded = true;
                })
                    .error(function () {
                        $scope.userNotFound = true;
                    });
                url = "https://api.github.com/users/" + username + '/repos' + $scope.oauth;
                $http.get(url).success(function (data) {

                    $scope.repos = data;
                    $scope.reposFound = data.length > 0;
                });
            }else{
                $scope.userNotFound = true;
            }
         }
    }
</script>

</body>
</html>
